# 数据分析平台技术文档

## 技术栈
- 前端：纯原生 JavaScript + CSS3 + HTML5
- 数据处理：xlsx.js 库
- 存储：浏览器 localStorage

## 核心功能实现

### 1. 密码验证机制
```javascript
// 密码存储：password.txt
// 登录状态保存：localStorage
const loginTime = localStorage.getItem('loginTime');
const hoursLimit = 48; // 登录有效期48小时
```

实现细节：
- 使用 localStorage 存储登录时间戳
- 48小时内自动登录
- 超时自动清除登录状态

### 2. 权重预设系统
存储位置：`weightPresets.js`

四种预设方案：
1. 曝光成交率优先
2. 成交件数优先
3. 讲解效率优先
4. 自定义方案

实现特点：
- 支持实时编辑和保存
- 使用 localStorage 保存自定义设置
- 自动验证权重总和为100%

### 3. 数据处理流程
1. Excel文件读取
   - 支持拖拽上传
   - 支持点击选择
   - 使用 xlsx.js 解析

2. 数据计算
   - 讲解效率得分
   - 曝光点击得分
   - 点击成交得分
   - 成交件数得分
   - 加权总分计算

3. 结果展示
   - 支持显示前10/20名
   - 实时排序
   - 自动计算期望成交量

## 文件结构
```
├── index.html          // 主页面
├── styles.css          // 样式文件
├── script.js           // 主要逻辑
├── config.js           // 配置文件
├── weightPresets.js    // 权重预设
├── password.txt        // 密码文件
└── README.md          // 使用说明
```

## 数据计算公式

### 1. 讲解效率分
```
效率得分 = min(max(0, (成交件数/讲解次数)/(调整后在线人数*讲解期望成交比例)*100), 100)
```

### 2. 曝光点击分
```
点击得分 = min(点击率*5, 100)
```

### 3. 点击成交分
```
成交得分 = min(成交率*10, 100)
```

### 4. 成交件数分
```
成交分 = min((成交件数/调整后在线人数*100)/成交比例要求*100, 100)
```

### 5. 总分计算
```
总分 = 效率得分*效率权重 + 点击得分*点击权重 + 成交得分*成交权重 + 成交分*成交权重
```

## 注意事项
1. 权重设置
   - 所有权重之和必须为100%
   - 权重修改后立即生效
   - 支持实时保存

2. 数据处理
   - 自动过滤无效数据
   - 自动处理异常值
   - 支持大数据量处理

3. 浏览器兼容
   - 支持主流现代浏览器
   - 需要启用 JavaScript
   - 需要支持 localStorage 

# 在线人数调整说明

## 调整机制

系统会对输入的平均在线人数进行自动调整，以更准确地反映实际可转化的有效在线人数。

### 计算公式

```
调整后人数 = max(0, 平均在线人数 - 调整值)
```

其中：
- 调整值：在 config.js 中定义的固定值 (CONFIG.ONLINE_ADJUSTMENT)
- max(0, x) 确保调整后人数不会出现负数

### 使用场景

调整后的在线人数用于以下计算：
1. 讲解效率分计算
2. 成交件数分计算
3. 期望成交单量计算

### 目的

这种调整机制的设计目的是为了：
- 更准确地反映实际可转化的有效在线人数
- 排除无效在线流量的影响
- 提供更合理的业绩评估基准

注：具体调整值请参考 config.js 文件中的 CONFIG.ONLINE_ADJUSTMENT 配置。